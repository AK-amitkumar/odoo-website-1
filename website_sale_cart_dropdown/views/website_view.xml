<?xml version="1.0" encoding="utf-8"?>

<!--
    Copyright (C) 2014-TODAY LasLabs, Inc. [https://laslabs.com]
    @author Dave Lasley <dave@laslabs.com>
    @license AGPL-3
-->

<openerp>
    <data>
        <template id="website_sale.header" inherit_id="website.layout" name="Header Shop My Cart Dropdown">
            <xpath expr="//header//ul[@id='top_menu']/li" position="before">
                <t t-set="website_sale_order" t-value="website.sale_get_order()" />
                <li t-att-class="'dropdown' if website_sale_order and website_sale_order.cart_quantity else 'hidden'">
                    <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                        <i class="fa fa-shopping-cart"></i>
                        Cart <sup t-attf-class="my_cart_quantity label label-primary"
                                  t-esc="website_sale_order and website_sale_order.cart_quantity or ''" />
                        <span class="caret" />
                    </a>
                    <ul class="dropdown-menu website-sale-cart-dropdown">
                        <t t-if="website_sale_order and website_sale_order.cart_quantity">
                            <t t-foreach="website_sale_order.website_order_line" t-as="line_id">
                                <li>
                                    <div class="oe_product_image">
                                        <div class="row">
                                            <div class="col-sm-4">
                                                <span t-field="line_id.product_id.image_small" t-att-alt="line_id.product_id.name"
                                                      t-field-options='{"widget": "image", "class": "img-rounded" }' />
                                            </div>
                                            <div class="col-sm-8">
                                            	<strong>
	                                            	<a t-attf-href="/shop/product/#{ slug(line_id.product_id.product_tmpl_id) }">
	                                                    <t t-esc="line_id.product_id.with_context(display_default_code=False).display_name" />
	                                                    <!-- Maybe add other info here? Look at https://github.com/odoo/odoo/blob/52484b0132ee3e0063dd67cc3c2eb434f99f5db8/addons/website_sale/views/templates.xml#L755 for ideas -->
	                                              	</a>
                                              	</strong>
                                            </div>
                                        </div>
                                        <div class="row">
                                        	<div class="col-sm-4"></div>
                                        	<div class="col-sm-8">
	                                        	<span class="dark-gray pull-left">
	                                        		<h6><t t-esc="line_id.product_uom_qty" /> x 
	                                        			<span t-field="line_id.price_unit" t-field-options='{
	                  										"widget": "monetary",
	                   										"display_currency": "website_sale_order.partner_invoice_id.property_product_pricelist.currency_id"
	               										}'>
	               										</span>
	               									</h6>
	                                        	</span>
	                                        </div>
                                        </div>
                                    </div>
                                </li>
                            </t>
                            <hr />
                        </t>
                        <span>
                            <a class="btn btn-primary" href="/shop/cart">
                            	View More
                            </a>
                        </span>
                    </ul>
                </li>
            </xpath>
        </template>
    </data>
</openerp>
